name: Deploy Clothes Shop
on:
   push:
      branches: [ main ]
   pull_request:
      branches: [ main ]
jobs:
   test:
     strategy:
      matrix:
         node-version: [16,17]
     runs-on: ubuntu-latest
     steps:
       - name: Get repository code
         uses: actions/checkout@v4
       - name: install Node JS
         uses: actions/setup-node@v3
         with:
           node-version: ${{matrix.node-version}}
       - name: Cache deps
         uses: actions/cache@v3
         with:
            path: ~/.npm
            key: node-modules-${{hashFiles('**/package-lock.json')}}
       - name: Install dependencies
         run: npm ci
       - name: e2e tests 
         run: npm run test:e2e
   lint:
      runs-on: ubuntu-latest
      steps:
        - name: Get repository code
          uses: actions/checkout@v4
        - name: Cache deps
          uses: actions/cache@v3
          with:
            path: ~/.npm
            key: node-modules-${{hashFiles('**/package-lock.json')}}
        - name: Install dependecies
          run: npm ci
        - name: Lint application
          run: npm run lint
   build:
      needs: [test, lint]
      strategy:
         matrix:
            node-version: [16,17]
      runs-on: ubuntu-latest
      steps:
         - name: Get repository code
           uses: actions/checkout@v4
         - name: install Node JS
           uses: actions/setup-node@v3
           with:
             node-version: ${{matrix.node-version}}
         - name: Cache deps
           uses: actions/cache@v3
           with:
             path: ~/.npm
             key: node-modules-${{hashFiles('**/package-lock.json')}}
         - name: Install dependecies
           run: npm ci
         - name: Build application
           run: npm run build
         - name: Deploy
           run: echo Deploying
      